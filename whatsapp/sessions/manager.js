const _0x488f95=_0x5af5;(function(_0x206980,_0x3fa541){const _0x329c0a=_0x5af5,_0x3ae2c1=_0x206980();while(!![]){try{const _0x12ede1=-parseInt(_0x329c0a(0x139))/0x1*(parseInt(_0x329c0a(0x153))/0x2)+-parseInt(_0x329c0a(0x1b5))/0x3*(-parseInt(_0x329c0a(0x134))/0x4)+parseInt(_0x329c0a(0x1c6))/0x5*(-parseInt(_0x329c0a(0x237))/0x6)+-parseInt(_0x329c0a(0x171))/0x7+parseInt(_0x329c0a(0x1be))/0x8+parseInt(_0x329c0a(0x187))/0x9*(parseInt(_0x329c0a(0x145))/0xa)+parseInt(_0x329c0a(0x162))/0xb*(parseInt(_0x329c0a(0x221))/0xc);if(_0x12ede1===_0x3fa541)break;else _0x3ae2c1['push'](_0x3ae2c1['shift']());}catch(_0x244915){_0x3ae2c1['push'](_0x3ae2c1['shift']());}}}(_0x5437,0xe88a2));import{createComponentLogger}from'../../utils/logger.js';function _0x5437(){const _0x40991e=['memoryUsage','5699712FqCpit','performMaintenance','\x20(logout)','connectionManager','_getActiveSessionsFromDatabase','flushWriteBuffers','_storeCleanup','\x20failed)','25HfEwxU','Deleted\x20session\x20sync:','utf8','_cleanupSocketInMemory','markSessionAsDetected','Inactive','webSessionDetector','_sessionStore','saveSession','info','üîÑ\x20Reconnecting\x20','getStats','Complete\x20cleanup\x20failed\x20for\x20','_startTrackingCleanup','hasValidAuthData','MongoDB\x20connection\x20pending\x20-\x20continuing','Event\x20handlers\x20set\x20up\x20for\x20','getAllSessions','disconnectSession','createConnection','setupCredsHandler','MAX_RETRY_ATTEMPTS','startsWith','Initialization\x20failed:','completelyDeleteSession','_initializeStorage','error','\x20existing\x20sessions','Message\x20store\x20deletion\x20failed:\x20','\x20already\x20connected','voluntarilyDisconnected',')\x20reached','preferred','isWebSessionDetected','isDirectory','_startDeletedSessionSync','getSession','then','size','connecting','Failed\x20to\x20disconnect\x20','Default\x20session\x20created\x20successfully','isBuffering','\x20created','üìÅ\x20File\x20mode:\x20Scanning\x20disk...','initializingSessions','messageStore','get','‚úÖ\x20Web\x20session\x20','Failed\x20session\x20retry:','slice','web','_initializeConnectionManager','connectionCallbacks','allSettled','isInitialized','üîÑ\x20Retrying\x20','Connection\x20manager\x20initialized','mongoClient','Disconnected','join','Waiting\x20for\x20MongoDB...\x20(','connectionStatus','Failed\x20to\x20create\x20','delete','PostgreSQL\x20update\x20failed:\x20','\x20deleted\x20from\x20MongoDB\x20-\x20cleaning','enableEventHandlers','setupConnectionHandler','detected','Starting\x20initialization\x20(concurrency=','Active','\x20active','function','deleteSession','Creating\x20','Session\x20init\x20failed\x20for\x20','\x20as\x20detected','sessionDir','‚úÖ\x20Message\x20store\x20deleted\x20for\x20','_startFailedSessionRetry','round','mongoStorage','clearVoluntaryDisconnection','start','add','checkAuthAvailability','database','MAX_SESSIONS','‚úÖ\x20Valid:\x20','cancelReconnection','72unlROw','üóëÔ∏è\x20COMPLETE\x20cleanup\x20for\x20','disconnected','\x20sessions)','Socket\x20cleanup\x20failed\x20for\x20','\x20error','Shutdown\x20error:',',\x20est.\x20','fileManager','Failed\x20to\x20create\x20web\x20session\x20',':\x20No\x20valid\x20auth','Cleaning\x20stale\x20auth\x20for\x20NEW\x20pairing:\x20','\x20session\x20folders','_readyState','failed','reconnectAttempts','MongoDB\x20ready','set','\x20-\x20performing\x20cleanup','updateSession','isSessionConnected','üìå\x20Marking\x20','1405038Aadcok','_enablePostInitFeatures','sessions515Restart','_waitForMongoDB','sessionState','\x20stale\x20entries,\x20','\x20already\x20initializing','catch','getSessionInfo','Maintenance\x20error:','Web\x20session\x20detection\x20started','STAGGER_DELAY','none','No\x20auth\x20for\x20','Session\x20manager\x20ready','‚úÖ\x20Telegram\x20user\x20','‚ùå\x20Default\x20session\x20error:\x20','‚úÖ\x20Initialization\x20complete:\x20','SYNC_INTERVAL','‚úÖ\x20Default\x20session\x20connected\x20with\x20','../storage/index.js','env','Session\x20manager\x20created\x20(max:\x20','getEventDispatcher','getStorage','115684VnHqIa','isReallyConnected','parse','Storage\x20initialized','close','218aMezCN','map','source','üóÑÔ∏è\x20MongoDB\x20mode:\x20Loading\x20from\x20database...','replace','Failed\x20to\x20get\x20stats:','isRunning','createSession','isConnected','sessions','socket','Database\x20cleanup\x20failed:\x20','23990MVmJhF','file','\x20PostgreSQL\x20preserved','Sessions\x20directory\x20','‚ùå\x20[','‚ùå\x20[Retry\x20','completed515Restart','removeAllListeners','mongodb','init','from','[Retry\x20','\x20-\x20preserving\x20files','getInitializationStatus','3734cHJLme','maxSessions','detectedWebSessions','warn','cleanupSessionFiles','\x20valid\x20sessions\x20with\x20auth','phoneNumber','\x20does\x20not\x20exist','‚ùå\x20Web\x20session\x20','Batch\x20','connectionEventHandler','‚úÖ\x20[','\x20(force:\x20','‚è≠Ô∏è\x20Skipping\x20','has','5559521GfOCnG','getSessionState','cleanup','telegramId','No\x20existing\x20sessions','unknown','\x20failed\x20sessions...','storage','Connected','success','STORAGE_MODE','üîÑ\x20Web\x20session\x20','userId','ENABLE_515_FLOW','eventHandlersSetup','13264699tQpSmV','createWebSession','_setupEventHandlers','cleanupOrphanedSessions','session_','\x20deleted\x20from\x20PostgreSQL','ceil','push','Telegram\x20user\x20','stop','_getSessionsFromFileSystem','Found\x20','isMongoConnected','connected','_cleanupSocket','isVoluntarilyDisconnected','value','../events/index.js','sessionEventHandlers','debug','postgresStorage','message','1359uwHOQD','eventHandlersEnabled','CLEANUP_INTERVAL','floor','Session\x20manager\x20shutdown\x20complete','Failed\x20to\x20initialize\x20sessions:','CONCURRENCY','telegram','activeSockets','File\x20mode\x20-\x20skipping\x20MongoDB\x20wait','keys','flush','../utils/index.js','status','forEach',',\x20515:\x20','Failed\x20to\x20create\x20default\x20session:\x20','performCompleteUserCleanup','RETRY_INTERVAL','filter','name','Failed\x20to\x20retrieve\x20statistics','client','eventDispatcher','üßπ\x20In-memory\x20cleanup\x20for\x20','path','Error\x20in\x20getSessionByWhatsAppJid:','isPostgresConnected','\x20disconnected','\x20(total:\x20','fs/promises','stopWebSessionDetection','now',']\x20Initializing\x20','üì±\x20[PAIRING]\x20Pairing\x20code\x20for\x20default\x20session:\x20','Failed\x20to\x20create\x20socket',',\x20reconnect:\x20','readdir','\x20disconnected\x20(metadata\x20preserved)','length','sessionId','No\x20existing\x20sessions,\x20but\x20phone\x20number\x20provided:\x20','Shutting\x20down\x20session\x20manager...','\x20cleaned','Creating\x20default\x20session\x20with\x20provided\x20phone\x20number...','Failed\x20to\x20get\x20active\x20sessions:','33ldKxqp','_initializeSession','‚úÖ\x20MongoDB\x20+\x20Files\x20cleanup\x20complete\x20for\x20','_startWebSessionDetection','../utils/session-lookup.js','../core/index.js','user','./sessions'];_0x5437=function(){return _0x40991e;};return _0x5437();}import{SessionState}from'./state.js';function _0x5af5(_0x50d5e5,_0x20d18c){_0x50d5e5=_0x50d5e5-0x123;const _0x543712=_0x5437();let _0x5af5f9=_0x543712[_0x50d5e5];return _0x5af5f9;}import{WebSessionDetector}from'./detector.js';import{SessionEventHandlers}from'./handlers.js';const logger=createComponentLogger('SESSION_MANAGER'),CONFIG={'MAX_SESSIONS':0x384,'CONCURRENCY':0x3,'STAGGER_DELAY':0x320,'BATCH_DELAY':0x5dc,'RETRY_INTERVAL':0x493e0,'SYNC_INTERVAL':0x1b58,'CLEANUP_INTERVAL':0xea60,'MAX_RETRY_ATTEMPTS':0xa,'ENABLE_515_FLOW':process[_0x488f95(0x130)][_0x488f95(0x16f)]==='true'};export class SessionManager{constructor(_0x26c439='./sessions',_0x489b4a=null){const _0x1dd3be=_0x488f95;this[_0x1dd3be(0x214)]=_0x26c439,this[_0x1dd3be(0x159)]=_0x489b4a,this[_0x1dd3be(0x169)]=null,this[_0x1dd3be(0x1c1)]=null,this['fileManager']=null,this[_0x1dd3be(0x19e)]=null,this[_0x1dd3be(0x18f)]=new Map(),this[_0x1dd3be(0x23b)]=new SessionState(),this['webSessionDetector']=null,this[_0x1dd3be(0x183)]=new SessionEventHandlers(this),this[_0x1dd3be(0x1f3)]=new Set(),this[_0x1dd3be(0x1e4)]=new Set(),this[_0x1dd3be(0x155)]=new Set(),CONFIG[_0x1dd3be(0x16f)]&&(this[_0x1dd3be(0x239)]=new Set(),this['completed515Restart']=new Set()),this['isInitialized']=![],this[_0x1dd3be(0x188)]=![],this[_0x1dd3be(0x1d3)](),this[_0x1dd3be(0x216)](),this[_0x1dd3be(0x1e9)](),logger[_0x1dd3be(0x1cf)](_0x1dd3be(0x131)+CONFIG[_0x1dd3be(0x21e)]+_0x1dd3be(0x196)+CONFIG[_0x1dd3be(0x16f)]+')');}async['initialize'](){const _0x22c3b2=_0x488f95;try{logger[_0x22c3b2(0x1cf)]('Initializing\x20session\x20manager...'),await this[_0x22c3b2(0x1df)](),await this[_0x22c3b2(0x1fa)]();const _0x3a5339=process[_0x22c3b2(0x130)][_0x22c3b2(0x16c)]||_0x22c3b2(0x146);return _0x3a5339==='mongodb'?await this['_waitForMongoDB']():logger[_0x22c3b2(0x1cf)](_0x22c3b2(0x190)),logger['info'](_0x22c3b2(0x129)),!![];}catch(_0x52b8ac){logger[_0x22c3b2(0x1e0)](_0x22c3b2(0x1dd),_0x52b8ac);throw _0x52b8ac;}}async[_0x488f95(0x1df)](){const _0x52f8f1=_0x488f95,{SessionStorage:_0x16357e}=await import('../storage/index.js');this[_0x52f8f1(0x169)]=new _0x16357e(),this[_0x52f8f1(0x169)][_0x52f8f1(0x14e)]&&await this[_0x52f8f1(0x169)][_0x52f8f1(0x14e)](),logger[_0x52f8f1(0x1cf)](_0x52f8f1(0x137));}async[_0x488f95(0x1fa)](){const _0x572b4=_0x488f95,{ConnectionManager:_0xc38724}=await import(_0x572b4(0x1ba)),{FileManager:_0x87e742}=await import(_0x572b4(0x12f));this[_0x572b4(0x229)]=new _0x87e742(this[_0x572b4(0x214)]),this['connectionManager']=new _0xc38724(),this[_0x572b4(0x1c1)]['initialize'](this[_0x572b4(0x229)],this['storage']),logger[_0x572b4(0x1cf)](_0x572b4(0x1ff));}async['_waitForMongoDB'](_0x147261=0x15f90){const _0x33b449=_0x488f95,_0x5c6c09=process[_0x33b449(0x130)][_0x33b449(0x16c)]||_0x33b449(0x146);if(_0x5c6c09!==_0x33b449(0x14d))return this['storage']['isMongoConnected']&&this[_0x33b449(0x169)][_0x33b449(0x19d)]&&(this[_0x33b449(0x1c1)][_0x33b449(0x200)]=this[_0x33b449(0x169)][_0x33b449(0x19d)]),!![];const _0x1efe73=Date[_0x33b449(0x1a7)]();let _0xcda27c=0x0;while(Date['now']()-_0x1efe73<_0x147261){if(this['storage'][_0x33b449(0x17d)]&&this[_0x33b449(0x169)][_0x33b449(0x142)])return logger[_0x33b449(0x1cf)](_0x33b449(0x231)),!![];const _0x5d2b41=Date[_0x33b449(0x1a7)]()-_0x1efe73;_0x5d2b41-_0xcda27c>0xbb8&&(logger[_0x33b449(0x184)](_0x33b449(0x203)+Math[_0x33b449(0x217)](_0x5d2b41/0x3e8)+'s)'),_0xcda27c=_0x5d2b41),await new Promise(_0x5c9b86=>setTimeout(_0x5c9b86,0x1f4));}return logger[_0x33b449(0x1cf)](_0x33b449(0x1d5)),!![];}async['initializeExistingSessions'](){const _0xdf80b2=_0x488f95;try{if(!this[_0xdf80b2(0x169)])await this['initialize']();const _0x2bf93b=process[_0xdf80b2(0x130)][_0xdf80b2(0x16c)]||_0xdf80b2(0x146);if(_0x2bf93b===_0xdf80b2(0x14d))await this[_0xdf80b2(0x23a)]();const _0x264b96=await this[_0xdf80b2(0x1c2)]();if(_0x264b96[_0xdf80b2(0x1ae)]===0x0){this[_0xdf80b2(0x1fd)]=!![],this[_0xdf80b2(0x238)]();if(this['phoneNumber']){logger[_0xdf80b2(0x1cf)](_0xdf80b2(0x1b0)+this[_0xdf80b2(0x159)]),logger['info'](_0xdf80b2(0x1b3));try{const _0x48c133='session_default';return await this[_0xdf80b2(0x140)](this[_0xdf80b2(0x159)],this['phoneNumber'],{'onPairingCode':_0x50c3d9=>{const _0x1e7bb1=_0xdf80b2;logger[_0x1e7bb1(0x1cf)](_0x1e7bb1(0x1a9)+_0x50c3d9);},'onConnected':()=>{const _0xe68ce8=_0xdf80b2;logger[_0xe68ce8(0x1cf)](_0xe68ce8(0x12e)+this['phoneNumber']);},'onError':_0x5cd709=>{const _0x27a58d=_0xdf80b2;logger['error'](_0x27a58d(0x12b)+_0x5cd709['message']);}},![],_0xdf80b2(0x1f9)),logger['info'](_0xdf80b2(0x1ef)),{'initialized':0x1,'total':0x1,'createdDefault':!![]};}catch(_0x2a5bba){return logger[_0xdf80b2(0x156)](_0xdf80b2(0x197)+_0x2a5bba[_0xdf80b2(0x186)]),logger['info'](_0xdf80b2(0x166)),{'initialized':0x0,'total':0x0,'createdDefault':![]};}}return logger[_0xdf80b2(0x1cf)](_0xdf80b2(0x166)),{'initialized':0x0,'total':0x0};}logger['info']('Found\x20'+_0x264b96['length']+_0xdf80b2(0x1e1));const _0x36502b=_0x264b96[_0xdf80b2(0x1f8)](0x0,CONFIG[_0xdf80b2(0x21e)]);let _0x27a1a5=0x0;const _0x335c09=[],_0x12a498=Math[_0xdf80b2(0x177)](_0x36502b[_0xdf80b2(0x1ae)]/CONFIG['CONCURRENCY']*0x3);logger[_0xdf80b2(0x1cf)](_0xdf80b2(0x20c)+CONFIG[_0xdf80b2(0x18d)]+_0xdf80b2(0x228)+_0x12a498+'s)');for(let _0x428bab=0x0;_0x428bab<_0x36502b['length'];_0x428bab+=CONFIG[_0xdf80b2(0x18d)]){const _0x1914b4=_0x36502b[_0xdf80b2(0x1f8)](_0x428bab,_0x428bab+CONFIG[_0xdf80b2(0x18d)]),_0x2ceb82=Math[_0xdf80b2(0x18a)](_0x428bab/CONFIG[_0xdf80b2(0x18d)])+0x1,_0x3130e0=Math['ceil'](_0x36502b[_0xdf80b2(0x1ae)]/CONFIG[_0xdf80b2(0x18d)]);logger['info']('Batch\x20'+_0x2ceb82+'/'+_0x3130e0+'\x20('+_0x1914b4[_0xdf80b2(0x1ae)]+_0xdf80b2(0x224));const _0x1b0ac5=await Promise[_0xdf80b2(0x1fc)](_0x1914b4[_0xdf80b2(0x13a)](async(_0x465e98,_0x4ab7bc)=>{const _0x4d31cc=_0xdf80b2;await new Promise(_0x154d8a=>setTimeout(_0x154d8a,_0x4ab7bc*CONFIG[_0x4d31cc(0x126)]));const _0x4f1b08=_0x428bab+_0x4ab7bc;logger['info']('['+(_0x4f1b08+0x1)+'/'+_0x36502b[_0x4d31cc(0x1ae)]+_0x4d31cc(0x1a8)+_0x465e98['sessionId']);const _0x3d564d=await this[_0x4d31cc(0x1b6)](_0x465e98);return _0x3d564d?(logger['info'](_0x4d31cc(0x15e)+(_0x4f1b08+0x1)+'/'+_0x36502b['length']+']\x20'+_0x465e98[_0x4d31cc(0x1af)]),{'success':!![],'data':_0x465e98}):(logger['warn'](_0x4d31cc(0x149)+(_0x4f1b08+0x1)+'/'+_0x36502b[_0x4d31cc(0x1ae)]+']\x20'+_0x465e98[_0x4d31cc(0x1af)]),{'success':![],'data':_0x465e98});}));for(const _0x406128 of _0x1b0ac5){if(_0x406128[_0xdf80b2(0x194)]==='fulfilled'&&_0x406128[_0xdf80b2(0x181)][_0xdf80b2(0x16b)])_0x27a1a5++;else _0x406128[_0xdf80b2(0x194)]==='fulfilled'&&!_0x406128[_0xdf80b2(0x181)][_0xdf80b2(0x16b)]&&_0x335c09[_0xdf80b2(0x178)](_0x406128[_0xdf80b2(0x181)]['data']);}const _0x3b0616=_0x1b0ac5['filter'](_0x3d600e=>_0x3d600e[_0xdf80b2(0x194)]==='fulfilled'&&_0x3d600e[_0xdf80b2(0x181)][_0xdf80b2(0x16b)])['length'];logger[_0xdf80b2(0x1cf)](_0xdf80b2(0x15c)+_0x2ceb82+'/'+_0x3130e0+':\x20'+_0x3b0616+'/'+_0x1914b4[_0xdf80b2(0x1ae)]+_0xdf80b2(0x1a4)+_0x27a1a5+'/'+_0x36502b['length']+')'),_0x428bab+CONFIG[_0xdf80b2(0x18d)]<_0x36502b[_0xdf80b2(0x1ae)]&&await new Promise(_0x1cd1b5=>setTimeout(_0x1cd1b5,CONFIG['BATCH_DELAY']));}if(_0x335c09[_0xdf80b2(0x1ae)]>0x0){logger[_0xdf80b2(0x1cf)](_0xdf80b2(0x1fe)+_0x335c09[_0xdf80b2(0x1ae)]+_0xdf80b2(0x168));for(let _0x12f02=0x0;_0x12f02<_0x335c09[_0xdf80b2(0x1ae)];_0x12f02++){const _0x47f1a7=_0x335c09[_0x12f02];logger[_0xdf80b2(0x1cf)](_0xdf80b2(0x150)+(_0x12f02+0x1)+'/'+_0x335c09[_0xdf80b2(0x1ae)]+']\x20'+_0x47f1a7[_0xdf80b2(0x1af)]),await new Promise(_0x3b50df=>setTimeout(_0x3b50df,0x7d0)),await this[_0xdf80b2(0x1b6)](_0x47f1a7)?(_0x27a1a5++,logger['info']('‚úÖ\x20[Retry\x20'+(_0x12f02+0x1)+'/'+_0x335c09[_0xdf80b2(0x1ae)]+']\x20'+_0x47f1a7[_0xdf80b2(0x1af)])):logger[_0xdf80b2(0x156)](_0xdf80b2(0x14a)+(_0x12f02+0x1)+'/'+_0x335c09['length']+']\x20'+_0x47f1a7[_0xdf80b2(0x1af)]);}}return this[_0xdf80b2(0x1fd)]=!![],this[_0xdf80b2(0x238)](),logger[_0xdf80b2(0x1cf)](_0xdf80b2(0x12c)+_0x27a1a5+'/'+_0x36502b[_0xdf80b2(0x1ae)]+'\x20('+(_0x36502b[_0xdf80b2(0x1ae)]-_0x27a1a5)+_0xdf80b2(0x1c5)),{'initialized':_0x27a1a5,'total':_0x36502b[_0xdf80b2(0x1ae)],'failed':_0x36502b[_0xdf80b2(0x1ae)]-_0x27a1a5};}catch(_0x251790){return logger[_0xdf80b2(0x1e0)](_0xdf80b2(0x18c),_0x251790),{'initialized':0x0,'total':0x0,'failed':0x0};}}async[_0x488f95(0x1b6)](_0x4543b1){const _0x5415d0=_0x488f95;if(this[_0x5415d0(0x1e4)][_0x5415d0(0x161)](_0x4543b1[_0x5415d0(0x1af)]))return![];try{const _0x1d7640=await this[_0x5415d0(0x1c1)][_0x5415d0(0x21c)](_0x4543b1[_0x5415d0(0x1af)]);if(_0x1d7640[_0x5415d0(0x1e6)]===_0x5415d0(0x127))return logger[_0x5415d0(0x156)](_0x5415d0(0x128)+_0x4543b1[_0x5415d0(0x1af)]+_0x5415d0(0x233)),await this[_0x5415d0(0x198)](_0x4543b1['sessionId']),this[_0x5415d0(0x1e4)][_0x5415d0(0x21b)](_0x4543b1['sessionId']),![];const _0x157e9f=await this['createSession'](_0x4543b1['userId'],_0x4543b1[_0x5415d0(0x159)],{},![],_0x4543b1[_0x5415d0(0x13b)]||_0x5415d0(0x18e),![]);if(!_0x157e9f)return logger[_0x5415d0(0x156)]('Failed\x20to\x20create\x20socket\x20for\x20'+_0x4543b1[_0x5415d0(0x1af)]),await this['storage']['updateSession'](_0x4543b1['sessionId'],{'isConnected':![],'connectionStatus':_0x5415d0(0x22f),'reconnectAttempts':(_0x4543b1[_0x5415d0(0x230)]||0x0)+0x1}),![];return!![];}catch(_0x38ff5f){return logger[_0x5415d0(0x1e0)](_0x5415d0(0x212)+_0x4543b1[_0x5415d0(0x1af)]+':',_0x38ff5f),await this[_0x5415d0(0x169)][_0x5415d0(0x234)](_0x4543b1[_0x5415d0(0x1af)],{'isConnected':![],'connectionStatus':'error','reconnectAttempts':(_0x4543b1['reconnectAttempts']||0x0)+0x1}),![];}}async[_0x488f95(0x1c2)](){const _0x297da3=_0x488f95;try{const _0x125020=process[_0x297da3(0x130)]['STORAGE_MODE']||_0x297da3(0x146);if(_0x125020==='file')return logger[_0x297da3(0x1cf)](_0x297da3(0x1f2)),await this[_0x297da3(0x17b)]();logger['info'](_0x297da3(0x13c));const _0x3f6124=await this['storage'][_0x297da3(0x1d7)](),_0x3dce06=_0x3f6124[_0x297da3(0x19a)](_0x136053=>_0x136053[_0x297da3(0x1af)]&&(_0x136053[_0x297da3(0x159)]||_0x136053[_0x297da3(0x141)]||['connected',_0x297da3(0x1ed)]['includes'](_0x136053[_0x297da3(0x204)])));return _0x3dce06['map'](_0x22e2ad=>({'sessionId':_0x22e2ad[_0x297da3(0x1af)],'userId':_0x22e2ad[_0x297da3(0x165)]||_0x22e2ad[_0x297da3(0x16e)],'telegramId':_0x22e2ad[_0x297da3(0x165)]||_0x22e2ad[_0x297da3(0x16e)],'phoneNumber':_0x22e2ad[_0x297da3(0x159)],'isConnected':_0x22e2ad['isConnected']!==undefined?_0x22e2ad[_0x297da3(0x141)]:![],'connectionStatus':_0x22e2ad[_0x297da3(0x204)]||'disconnected','source':_0x22e2ad['source']||'telegram','detected':_0x22e2ad[_0x297da3(0x20b)]!==![]}));}catch(_0x257811){return logger[_0x297da3(0x1e0)](_0x297da3(0x1b4),_0x257811),[];}}async['_getSessionsFromFileSystem'](){const _0xa2aa63=_0x488f95;try{const _0xecafec=await import(_0xa2aa63(0x1a5)),_0x31739e=await import(_0xa2aa63(0x1a0));try{await _0xecafec['access'](this[_0xa2aa63(0x214)]);}catch{return logger['info'](_0xa2aa63(0x148)+this[_0xa2aa63(0x214)]+_0xa2aa63(0x15a)),[];}const _0x33a298=await _0xecafec[_0xa2aa63(0x1ac)](this[_0xa2aa63(0x214)],{'withFileTypes':!![]}),_0x3f1f15=_0x33a298[_0xa2aa63(0x19a)](_0x303d8f=>_0x303d8f[_0xa2aa63(0x1e8)]()&&_0x303d8f['name'][_0xa2aa63(0x1dc)](_0xa2aa63(0x175)));logger[_0xa2aa63(0x1cf)](_0xa2aa63(0x17c)+_0x3f1f15['length']+_0xa2aa63(0x22d));const _0x4173ad=[];for(const _0x1c1c1f of _0x3f1f15){const _0x1e9044=_0x1c1c1f[_0xa2aa63(0x19b)],_0x51d64f=_0x31739e[_0xa2aa63(0x202)](this[_0xa2aa63(0x214)],_0x1e9044),_0x338ed3=_0x31739e[_0xa2aa63(0x202)](_0x51d64f,'creds.json');try{await _0xecafec['access'](_0x338ed3);let _0x5f368c=null;try{const _0x5aef94=await _0xecafec['readFile'](_0x338ed3,_0xa2aa63(0x1c8)),_0x57e169=JSON[_0xa2aa63(0x136)](_0x5aef94);_0x5f368c=_0x57e169['me']?.['id']?.['split'](':')[0x0]||null;}catch{}const _0x41bffc=_0x1e9044[_0xa2aa63(0x13d)](_0xa2aa63(0x175),'');let _0x56c90b=null;try{_0x56c90b=await this[_0xa2aa63(0x169)][_0xa2aa63(0x1ea)](_0x1e9044);}catch{}_0x4173ad['push']({'sessionId':_0x1e9044,'userId':_0x56c90b?.[_0xa2aa63(0x16e)]||_0x41bffc,'telegramId':_0x56c90b?.[_0xa2aa63(0x165)]||_0x41bffc,'phoneNumber':_0x5f368c||_0x56c90b?.[_0xa2aa63(0x159)],'isConnected':![],'connectionStatus':_0xa2aa63(0x223),'source':_0x56c90b?.[_0xa2aa63(0x13b)]||_0xa2aa63(0x18e),'detected':_0x56c90b?.[_0xa2aa63(0x20b)]!==![]}),logger[_0xa2aa63(0x184)](_0xa2aa63(0x21f)+_0x1e9044+'\x20(phone:\x20'+(_0x5f368c||_0xa2aa63(0x167))+')');}catch{logger[_0xa2aa63(0x184)](_0xa2aa63(0x160)+_0x1e9044+_0xa2aa63(0x22b));}}return logger[_0xa2aa63(0x1cf)](_0xa2aa63(0x17c)+_0x4173ad['length']+_0xa2aa63(0x158)),_0x4173ad;}catch(_0x3d321a){return logger[_0xa2aa63(0x1e0)]('Failed\x20to\x20scan\x20file\x20system:',_0x3d321a),[];}}[_0x488f95(0x238)](){setTimeout(()=>{const _0x5c951b=_0x5af5;this[_0x5c951b(0x209)](),this['_startWebSessionDetection']();},0x7d0);}['enableEventHandlers'](){const _0x2a25f8=_0x488f95;this[_0x2a25f8(0x188)]=!![];for(const [_0x26be3d,_0x281518]of this[_0x2a25f8(0x18f)]){_0x281518?.[_0x2a25f8(0x1bb)]&&_0x281518['ws']?.[_0x2a25f8(0x143)]?.[_0x2a25f8(0x22e)]===0x1&&!_0x281518[_0x2a25f8(0x170)]&&this[_0x2a25f8(0x173)](_0x281518,_0x26be3d)[_0x2a25f8(0x23e)](()=>{});}logger[_0x2a25f8(0x1cf)]('Event\x20handlers\x20enabled');}async[_0x488f95(0x173)](_0x1a5007,_0x389bf1){const _0x2ade45=_0x488f95;try{if(!_0x1a5007||_0x1a5007[_0x2ade45(0x170)]||!_0x1a5007[_0x2ade45(0x1bb)])return;if(!_0x1a5007['ws']?.[_0x2ade45(0x143)]||_0x1a5007['ws']['socket'][_0x2ade45(0x22e)]!==0x1)return;const {EventDispatcher:_0x385f6e}=await import(_0x2ade45(0x182));!this[_0x2ade45(0x19e)]&&(this[_0x2ade45(0x19e)]=new _0x385f6e(this)),this[_0x2ade45(0x19e)]['setupEventHandlers'](_0x1a5007,_0x389bf1),_0x1a5007['eventHandlersSetup']=!![],_0x1a5007['ev'][_0x2ade45(0x1f0)]&&_0x1a5007['ev'][_0x2ade45(0x1f0)]()&&_0x1a5007['ev'][_0x2ade45(0x192)](),logger[_0x2ade45(0x1cf)](_0x2ade45(0x1d6)+_0x389bf1);}catch(_0x1a52b9){logger[_0x2ade45(0x1e0)]('Failed\x20to\x20setup\x20handlers\x20for\x20'+_0x389bf1+':',_0x1a52b9);}}[_0x488f95(0x1b8)](){const _0x1a8b57=_0x488f95;this[_0x1a8b57(0x1cc)]&&this[_0x1a8b57(0x1cc)]['stop'](),this[_0x1a8b57(0x1cc)]=new WebSessionDetector(this[_0x1a8b57(0x169)],this),this[_0x1a8b57(0x1cc)][_0x1a8b57(0x21a)](),logger[_0x1a8b57(0x1cf)](_0x1a8b57(0x125));}[_0x488f95(0x1a6)](){const _0x3c7fb1=_0x488f95;this[_0x3c7fb1(0x1cc)]&&this[_0x3c7fb1(0x1cc)][_0x3c7fb1(0x17a)]();}async[_0x488f95(0x140)](_0x109e04,_0x4b9c3c=null,_0x266b22={},_0x1cc1e9=![],_0x3f7c9d=_0x488f95(0x18e),_0x2aaec9=!![]){const _0x3ebbc1=_0x488f95,_0x226319=String(_0x109e04),_0x33e283=_0x226319[_0x3ebbc1(0x1dc)](_0x3ebbc1(0x175))?_0x226319:'session_'+_0x226319,_0x17569f=_0x4b9c3c||this[_0x3ebbc1(0x159)];try{if(this['initializingSessions'][_0x3ebbc1(0x161)](_0x33e283))return logger[_0x3ebbc1(0x156)](_0x33e283+_0x3ebbc1(0x23d)),this['activeSockets']['get'](_0x33e283);if(this[_0x3ebbc1(0x18f)]['has'](_0x33e283)&&!_0x1cc1e9){const _0x33ddbd=this[_0x3ebbc1(0x18f)][_0x3ebbc1(0x1f5)](_0x33e283),_0xc548df=_0x33ddbd?.['user']&&_0x33ddbd?.['ws']?.[_0x3ebbc1(0x143)]?.[_0x3ebbc1(0x22e)]===0x1;if(_0xc548df)return logger[_0x3ebbc1(0x1cf)](_0x33e283+_0x3ebbc1(0x1e3)),_0x33ddbd;else logger[_0x3ebbc1(0x156)](_0x33e283+'\x20exists\x20but\x20not\x20connected\x20-\x20recreating'),await this['_cleanupSocketInMemory'](_0x33e283);}if(this['activeSockets'][_0x3ebbc1(0x1ec)]>=CONFIG[_0x3ebbc1(0x21e)])throw new Error('Maximum\x20sessions\x20limit\x20('+CONFIG[_0x3ebbc1(0x21e)]+_0x3ebbc1(0x1e5));this[_0x3ebbc1(0x1f3)][_0x3ebbc1(0x21b)](_0x33e283),logger['info'](_0x3ebbc1(0x211)+_0x33e283+'\x20('+_0x3f7c9d+_0x3ebbc1(0x1ab)+_0x1cc1e9+')');if(_0x1cc1e9)logger[_0x3ebbc1(0x1cf)](_0x3ebbc1(0x1d0)+_0x33e283+_0x3ebbc1(0x151)),await this[_0x3ebbc1(0x1c9)](_0x33e283);else{if(_0x2aaec9){const _0x381ffe=this[_0x3ebbc1(0x18f)][_0x3ebbc1(0x161)](_0x33e283),_0x144276=await this[_0x3ebbc1(0x1c1)]['checkAuthAvailability'](_0x33e283);_0x144276[_0x3ebbc1(0x1e6)]!==_0x3ebbc1(0x127)&&!_0x381ffe&&(logger[_0x3ebbc1(0x1cf)](_0x3ebbc1(0x22c)+_0x33e283),await this[_0x3ebbc1(0x198)](_0x33e283),await new Promise(_0x29bd3d=>setTimeout(_0x29bd3d,0x3e8)));}}const _0x305239=await this[_0x3ebbc1(0x1c1)][_0x3ebbc1(0x1d9)](_0x33e283,_0x17569f,_0x266b22,_0x2aaec9);if(!_0x305239)throw new Error(_0x3ebbc1(0x1aa));return this[_0x3ebbc1(0x18f)][_0x3ebbc1(0x232)](_0x33e283,_0x305239),_0x305239['connectionCallbacks']=_0x266b22,this[_0x3ebbc1(0x23b)][_0x3ebbc1(0x232)](_0x33e283,{'userId':_0x226319,'phoneNumber':_0x17569f,'source':_0x3f7c9d,'isConnected':!![],'connectionStatus':_0x3ebbc1(0x17e),'callbacks':_0x266b22}),this[_0x3ebbc1(0x183)][_0x3ebbc1(0x20a)](_0x305239,_0x33e283,_0x266b22),this[_0x3ebbc1(0x183)][_0x3ebbc1(0x1da)](_0x305239,_0x33e283),!_0x305239[_0x3ebbc1(0x170)]&&await this[_0x3ebbc1(0x173)](_0x305239,_0x33e283),await this[_0x3ebbc1(0x169)][_0x3ebbc1(0x1ce)](_0x33e283,{'userId':_0x226319,'telegramId':_0x226319,'phoneNumber':_0x4b9c3c,'isConnected':!![],'connectionStatus':_0x3ebbc1(0x17e),'reconnectAttempts':0x0,'source':_0x3f7c9d,'detected':_0x3f7c9d===_0x3ebbc1(0x1f9)?![]:!![]}),logger[_0x3ebbc1(0x1cf)]('‚úÖ\x20'+_0x33e283+_0x3ebbc1(0x1f1)),_0x305239;}catch(_0x3d5733){logger[_0x3ebbc1(0x1e0)](_0x3ebbc1(0x205)+_0x33e283+':',_0x3d5733);throw _0x3d5733;}finally{this[_0x3ebbc1(0x1f3)][_0x3ebbc1(0x206)](_0x33e283);}}async[_0x488f95(0x172)](_0x27b21f){const _0x56e8e6=_0x488f95,{sessionId:_0x969b08,userId:_0xcebbb7,phoneNumber:_0x5e1d37}=_0x27b21f;try{logger[_0x56e8e6(0x1cf)](_0x56e8e6(0x236)+_0x969b08+_0x56e8e6(0x213)),await this[_0x56e8e6(0x169)][_0x56e8e6(0x1ca)](_0x969b08,!![]),this['detectedWebSessions'][_0x56e8e6(0x21b)](_0x969b08);const _0x15595a=await this[_0x56e8e6(0x140)](_0xcebbb7,_0x5e1d37,{'onConnected':()=>logger[_0x56e8e6(0x1cf)](_0x56e8e6(0x1f6)+_0x969b08+'\x20connected'),'onError':()=>{const _0x495cc5=_0x56e8e6;logger[_0x495cc5(0x1e0)](_0x495cc5(0x15b)+_0x969b08+_0x495cc5(0x226)),this[_0x495cc5(0x155)][_0x495cc5(0x206)](_0x969b08),this[_0x495cc5(0x169)][_0x495cc5(0x1ca)](_0x969b08,![])[_0x495cc5(0x23e)](()=>{});}},![],_0x56e8e6(0x1f9),!![]);return!!_0x15595a;}catch(_0x6d2fb6){return logger[_0x56e8e6(0x1e0)](_0x56e8e6(0x22a)+_0x969b08+':',_0x6d2fb6),this['detectedWebSessions'][_0x56e8e6(0x206)](_0x969b08),await this[_0x56e8e6(0x169)][_0x56e8e6(0x1ca)](_0x969b08,![]),![];}}async[_0x488f95(0x1d8)](_0x4b1840,_0x981feb=![]){const _0x5e530e=_0x488f95;try{logger[_0x5e530e(0x1cf)]('Disconnecting\x20'+_0x4b1840+_0x5e530e(0x15f)+_0x981feb+')');const _0x59650c=this[_0x5e530e(0x132)](),_0x33eef5=_0x59650c?.[_0x5e530e(0x15d)];_0x33eef5&&_0x33eef5[_0x5e530e(0x220)](_0x4b1840);const _0x2abc3e=await this['storage'][_0x5e530e(0x1ea)](_0x4b1840),_0x31e0a5=_0x2abc3e?.[_0x5e530e(0x13b)]===_0x5e530e(0x1f9);if(_0x981feb)return await this[_0x5e530e(0x198)](_0x4b1840);this['initializingSessions']['delete'](_0x4b1840),this[_0x5e530e(0x1e4)]['add'](_0x4b1840),this[_0x5e530e(0x155)]['delete'](_0x4b1840);const _0x4123da=this[_0x5e530e(0x18f)][_0x5e530e(0x1f5)](_0x4b1840);return _0x4123da&&await this[_0x5e530e(0x17f)](_0x4b1840,_0x4123da),this[_0x5e530e(0x18f)][_0x5e530e(0x206)](_0x4b1840),this['sessionState']['delete'](_0x4b1840),_0x31e0a5?(await this[_0x5e530e(0x169)][_0x5e530e(0x234)](_0x4b1840,{'isConnected':![],'connectionStatus':_0x5e530e(0x223)}),logger[_0x5e530e(0x1cf)]('Web\x20user\x20'+_0x4b1840+_0x5e530e(0x1ad))):(await this['storage'][_0x5e530e(0x210)](_0x4b1840),logger['info'](_0x5e530e(0x179)+_0x4b1840+'\x20disconnected\x20(can\x20reconnect)')),logger[_0x5e530e(0x1cf)](_0x4b1840+_0x5e530e(0x1a3)),!![];}catch(_0xcb0986){return logger['error'](_0x5e530e(0x1ee)+_0x4b1840+':',_0xcb0986),![];}}async[_0x488f95(0x1c9)](_0x4ef85f){const _0x3d1d37=_0x488f95;try{logger['info'](_0x3d1d37(0x19f)+_0x4ef85f);const _0x14c2f3={'messageStore':![]};try{const {deleteSessionStore:_0x5eb2be}=await import(_0x3d1d37(0x1ba));await _0x5eb2be(_0x4ef85f),_0x14c2f3[_0x3d1d37(0x1f4)]=!![],logger[_0x3d1d37(0x1cf)]('‚úÖ\x20Message\x20store\x20deleted\x20for\x20'+_0x4ef85f);}catch(_0x3015b8){logger[_0x3d1d37(0x1e0)](_0x3d1d37(0x1e2)+_0x3015b8['message']);}const _0x6bf379=this[_0x3d1d37(0x18f)][_0x3d1d37(0x1f5)](_0x4ef85f);if(_0x6bf379){if(_0x6bf379?.['ev']?.['isBuffering']?.())try{_0x6bf379['ev']['flush']();}catch{}_0x6bf379['ev']&&typeof _0x6bf379['ev'][_0x3d1d37(0x14c)]===_0x3d1d37(0x20f)&&_0x6bf379['ev'][_0x3d1d37(0x14c)](),_0x6bf379['ws']?.['socket']&&_0x6bf379['ws'][_0x3d1d37(0x143)][_0x3d1d37(0x22e)]===0x1&&_0x6bf379['ws'][_0x3d1d37(0x138)](0x3e8,'Reconnect'),_0x6bf379['user']=null,_0x6bf379[_0x3d1d37(0x170)]=![],_0x6bf379[_0x3d1d37(0x1fb)]=null,_0x6bf379[_0x3d1d37(0x1cd)]=null;}return this[_0x3d1d37(0x18f)][_0x3d1d37(0x206)](_0x4ef85f),this[_0x3d1d37(0x23b)][_0x3d1d37(0x206)](_0x4ef85f),logger['info']('‚úÖ\x20Socket\x20cleaned\x20in-memory\x20for\x20'+_0x4ef85f),!![];}catch(_0x1314e7){return logger['error']('Failed\x20in-memory\x20cleanup\x20for\x20'+_0x4ef85f+':',_0x1314e7),![];}}async[_0x488f95(0x17f)](_0x3e838c,_0xc712a9){const _0x38db40=_0x488f95;try{if(_0xc712a9?.['ev']?.[_0x38db40(0x1f0)]?.())try{_0xc712a9['ev'][_0x38db40(0x192)]();}catch{}return _0xc712a9[_0x38db40(0x1c4)]&&_0xc712a9[_0x38db40(0x1c4)](),_0xc712a9['ev']&&typeof _0xc712a9['ev']['removeAllListeners']===_0x38db40(0x20f)&&_0xc712a9['ev']['removeAllListeners'](),_0xc712a9['ws']?.[_0x38db40(0x143)]&&_0xc712a9['ws']['socket']['_readyState']===0x1&&_0xc712a9['ws'][_0x38db40(0x138)](0x3e8,'Cleanup'),_0xc712a9[_0x38db40(0x1bb)]=null,_0xc712a9[_0x38db40(0x170)]=![],_0xc712a9[_0x38db40(0x1fb)]=null,_0xc712a9[_0x38db40(0x1cd)]=null,!![];}catch(_0x50f1b7){return logger[_0x38db40(0x1e0)](_0x38db40(0x225)+_0x3e838c+':',_0x50f1b7),![];}}async[_0x488f95(0x198)](_0x5a135c){const _0x19da3c=_0x488f95,_0x37546f={'socket':![],'database':![],'authState':![],'messageStore':![]};try{logger[_0x19da3c(0x1cf)](_0x19da3c(0x222)+_0x5a135c+_0x19da3c(0x1c0));const _0x2ebb8d=await this[_0x19da3c(0x169)][_0x19da3c(0x1ea)](_0x5a135c),_0x160297=_0x2ebb8d?.[_0x19da3c(0x13b)]===_0x19da3c(0x1f9),_0x2756bb=this['getEventDispatcher'](),_0x2128e7=_0x2756bb?.['connectionEventHandler'];_0x2128e7&&_0x2128e7['cancelReconnection'](_0x5a135c);const _0x568913=this[_0x19da3c(0x18f)]['get'](_0x5a135c);_0x568913&&(_0x37546f['socket']=await this[_0x19da3c(0x17f)](_0x5a135c,_0x568913));this[_0x19da3c(0x18f)][_0x19da3c(0x206)](_0x5a135c),this[_0x19da3c(0x23b)][_0x19da3c(0x206)](_0x5a135c),this['initializingSessions']['delete'](_0x5a135c),this[_0x19da3c(0x1e4)][_0x19da3c(0x21b)](_0x5a135c),this[_0x19da3c(0x155)][_0x19da3c(0x206)](_0x5a135c);try{const {deleteSessionStore:_0x1cf790}=await import(_0x19da3c(0x1ba));await _0x1cf790(_0x5a135c),_0x37546f[_0x19da3c(0x1f4)]=!![],logger[_0x19da3c(0x1cf)](_0x19da3c(0x215)+_0x5a135c);}catch(_0x19ad0e){logger['error'](_0x19da3c(0x1e2)+_0x19ad0e[_0x19da3c(0x186)]);}try{await this['storage'][_0x19da3c(0x229)][_0x19da3c(0x157)](_0x5a135c),this['storage']['isMongoConnected']&&await this['storage'][_0x19da3c(0x218)]['completeCleanup'](_0x5a135c),_0x37546f[_0x19da3c(0x21d)]=!![],_0x37546f['authState']=!![],logger['info'](_0x19da3c(0x1b7)+_0x5a135c);}catch(_0x110715){logger[_0x19da3c(0x1e0)](_0x19da3c(0x144)+_0x110715[_0x19da3c(0x186)]);}if(this[_0x19da3c(0x169)][_0x19da3c(0x1a2)]){if(_0x160297)try{await this['storage']['postgresStorage'][_0x19da3c(0x234)](_0x5a135c,{'isConnected':![],'connectionStatus':'disconnected','updatedAt':new Date()}),logger[_0x19da3c(0x1cf)]('‚úÖ\x20Web\x20user\x20'+_0x5a135c+_0x19da3c(0x147));}catch(_0x3dc785){logger[_0x19da3c(0x1e0)](_0x19da3c(0x207)+_0x3dc785[_0x19da3c(0x186)]);}else try{await this[_0x19da3c(0x169)][_0x19da3c(0x185)][_0x19da3c(0x1de)](_0x5a135c),logger[_0x19da3c(0x1cf)](_0x19da3c(0x12a)+_0x5a135c+_0x19da3c(0x176));}catch(_0x37077f){logger[_0x19da3c(0x1e0)]('PostgreSQL\x20deletion\x20failed:\x20'+_0x37077f['message']);}}return logger[_0x19da3c(0x1cf)]('‚úÖ\x20Complete\x20cleanup\x20for\x20'+_0x5a135c+':',_0x37546f),_0x37546f;}catch(_0x2e3852){return logger[_0x19da3c(0x1e0)](_0x19da3c(0x1d2)+_0x5a135c+':',_0x2e3852),_0x37546f;}}[_0x488f95(0x1d3)](){const _0x4cd162=_0x488f95;setInterval(()=>{const _0x41f6e4=_0x5af5,_0x1b1c51=new Set(this['activeSockets']['keys']());let _0x432322=0x0;const _0x5cb3e0=_0x54a684=>{const _0x2a7f63=_0x5af5,_0x2226a8=[];for(const _0x488773 of _0x54a684){if(!_0x1b1c51[_0x2a7f63(0x161)](_0x488773))_0x2226a8[_0x2a7f63(0x178)](_0x488773);}_0x2226a8[_0x2a7f63(0x195)](_0x87376c=>{_0x54a684['delete'](_0x87376c),_0x432322++;});};_0x5cb3e0(this[_0x41f6e4(0x1f3)]),_0x5cb3e0(this[_0x41f6e4(0x1e4)]),_0x5cb3e0(this[_0x41f6e4(0x155)]);CONFIG[_0x41f6e4(0x16f)]&&(_0x5cb3e0(this['sessions515Restart']),_0x5cb3e0(this[_0x41f6e4(0x14b)]));_0x432322>0x0&&logger[_0x41f6e4(0x184)]('Tracking\x20cleanup:\x20'+_0x432322+_0x41f6e4(0x23c)+this[_0x41f6e4(0x18f)][_0x41f6e4(0x1ec)]+_0x41f6e4(0x20e));const _0x5f58ca=process[_0x41f6e4(0x1bd)]();},CONFIG[_0x4cd162(0x189)]);}[_0x488f95(0x216)](){const _0x23a2ad=_0x488f95;setInterval(async()=>{const _0x286167=_0x5af5;if(!this[_0x286167(0x1fd)])return;try{const _0x4afa14=await this[_0x286167(0x169)]['getAllSessions'](),_0x560e0d=_0x4afa14[_0x286167(0x19a)](_0x9a75c9=>!_0x9a75c9[_0x286167(0x141)]&&_0x9a75c9[_0x286167(0x204)]!==_0x286167(0x223)&&!this[_0x286167(0x1e4)][_0x286167(0x161)](_0x9a75c9[_0x286167(0x1af)])&&!this[_0x286167(0x18f)]['has'](_0x9a75c9['sessionId'])&&(_0x9a75c9[_0x286167(0x230)]||0x0)<CONFIG[_0x286167(0x1db)]);if(_0x560e0d[_0x286167(0x1ae)]>0x0){logger[_0x286167(0x1cf)]('üîÑ\x20Retrying\x20'+_0x560e0d['length']+'\x20failed\x20sessions...');for(const _0x4b1991 of _0x560e0d[_0x286167(0x1f8)](0x0,0x3)){await this[_0x286167(0x1b6)](_0x4b1991),await new Promise(_0x27601f=>setTimeout(_0x27601f,0x7d0));}}}catch(_0x576886){logger[_0x286167(0x1e0)](_0x286167(0x1f7),_0x576886);}},CONFIG[_0x23a2ad(0x199)]);}['_startDeletedSessionSync'](){const _0x4c6451=_0x488f95;setInterval(async()=>{const _0x2acdf1=_0x5af5;if(!this[_0x2acdf1(0x1fd)])return;try{const _0x6e455f=Array[_0x2acdf1(0x14f)](this[_0x2acdf1(0x18f)][_0x2acdf1(0x191)]());for(const _0x143c86 of _0x6e455f){const _0x41e83d=await this[_0x2acdf1(0x169)][_0x2acdf1(0x1ea)](_0x143c86);if(this[_0x2acdf1(0x169)][_0x2acdf1(0x1a2)]){const _0x396ac7=await this[_0x2acdf1(0x169)][_0x2acdf1(0x185)][_0x2acdf1(0x1ea)](_0x143c86);if(_0x396ac7?.[_0x2acdf1(0x13b)]===_0x2acdf1(0x1f9)){const _0x281a2b=this[_0x2acdf1(0x169)][_0x2acdf1(0x17d)]?await this[_0x2acdf1(0x169)]['mongoStorage'][_0x2acdf1(0x1d4)](_0x143c86):![];if(!_0x41e83d&&!_0x281a2b){logger[_0x2acdf1(0x156)](_0x2acdf1(0x16d)+_0x143c86+_0x2acdf1(0x208));const _0x238284=this[_0x2acdf1(0x18f)][_0x2acdf1(0x1f5)](_0x143c86);_0x238284&&await this[_0x2acdf1(0x17f)](_0x143c86,_0x238284);this[_0x2acdf1(0x18f)][_0x2acdf1(0x206)](_0x143c86),this[_0x2acdf1(0x23b)]['delete'](_0x143c86),this['detectedWebSessions'][_0x2acdf1(0x206)](_0x143c86),await this[_0x2acdf1(0x169)][_0x2acdf1(0x229)][_0x2acdf1(0x157)](_0x143c86);try{const {deleteSessionStore:_0x26521d}=await import(_0x2acdf1(0x1ba));await _0x26521d(_0x143c86);}catch{}await this[_0x2acdf1(0x169)][_0x2acdf1(0x185)]['updateSession'](_0x143c86,{'isConnected':![],'connectionStatus':_0x2acdf1(0x223),'updatedAt':new Date()}),logger[_0x2acdf1(0x1cf)](_0x2acdf1(0x1f6)+_0x143c86+_0x2acdf1(0x1b2));}}}}}catch(_0xd5b360){logger['error'](_0x2acdf1(0x1c7),_0xd5b360);}},CONFIG[_0x4c6451(0x12d)]);}[_0x488f95(0x1ea)](_0x5d01cf){const _0x439b14=_0x488f95,_0x21e192=this[_0x439b14(0x18f)]['get'](_0x5d01cf);return!_0x21e192&&_0x5d01cf&&import(_0x439b14(0x193))[_0x439b14(0x1eb)](({invalidateSessionLookupCache:_0x453a22})=>{_0x453a22(_0x5d01cf);})[_0x439b14(0x23e)](()=>{}),_0x21e192;}async['getSessionByWhatsAppJid'](_0x5babd6){const _0x136125=_0x488f95;if(!_0x5babd6)return null;try{const {getSessionByRemoteJid:_0x1106a6}=await import(_0x136125(0x1b9));return await _0x1106a6(_0x5babd6,this);}catch(_0x22039d){return logger[_0x136125(0x1e0)](_0x136125(0x1a1),_0x22039d),null;}}async['getAllSessions'](){const _0x1d8a97=_0x488f95;return await this[_0x1d8a97(0x169)][_0x1d8a97(0x1d7)]();}async[_0x488f95(0x235)](_0x3a7cd9){const _0x4446f9=_0x488f95,_0x22d930=await this['storage']['getSession'](_0x3a7cd9);return _0x22d930?.[_0x4446f9(0x141)]||![];}async[_0x488f95(0x135)](_0x524f92){const _0x5a05bc=_0x488f95,_0x2d27d9=this['activeSockets'][_0x5a05bc(0x1f5)](_0x524f92),_0x5eec34=await this[_0x5a05bc(0x169)][_0x5a05bc(0x1ea)](_0x524f92);return!!(_0x2d27d9&&_0x2d27d9[_0x5a05bc(0x1bb)]&&_0x5eec34?.['isConnected']);}async[_0x488f95(0x123)](_0x134379){const _0x4bbe8a=_0x488f95,_0x3d68ef=await this[_0x4bbe8a(0x169)]['getSession'](_0x134379),_0x13282d=this[_0x4bbe8a(0x18f)]['has'](_0x134379),_0x3792ae=this[_0x4bbe8a(0x23b)][_0x4bbe8a(0x1f5)](_0x134379);return{..._0x3d68ef,'hasSocket':_0x13282d,'stateInfo':_0x3792ae};}[_0x488f95(0x180)](_0x5a8c59){const _0x2839c5=_0x488f95;return this['voluntarilyDisconnected'][_0x2839c5(0x161)](_0x5a8c59);}[_0x488f95(0x219)](_0x4b8b0c){const _0x1835fe=_0x488f95;this[_0x1835fe(0x1e4)][_0x1835fe(0x206)](_0x4b8b0c);}[_0x488f95(0x1e7)](_0x429eb4){const _0x1f93a0=_0x488f95;return this[_0x1f93a0(0x155)][_0x1f93a0(0x161)](_0x429eb4);}[_0x488f95(0x152)](){const _0x12ab85=_0x488f95;return{'isInitialized':this[_0x12ab85(0x1fd)],'activeSessions':this[_0x12ab85(0x18f)][_0x12ab85(0x1ec)],'initializingSessions':this['initializingSessions'][_0x12ab85(0x1ec)],'eventHandlersEnabled':this['eventHandlersEnabled'],'webDetectionActive':this[_0x12ab85(0x1cc)]?.['isRunning']()||![],'enable515Flow':ENABLE_515_FLOW};}async[_0x488f95(0x1d1)](){const _0x19d079=_0x488f95;try{const _0x89def6=await this['storage']['getAllSessions'](),_0x41ff8b=_0x89def6[_0x19d079(0x19a)](_0x9b511d=>_0x9b511d[_0x19d079(0x141)]),_0x5bee8a=_0x89def6[_0x19d079(0x19a)](_0x14f3d0=>_0x14f3d0[_0x19d079(0x13b)]===_0x19d079(0x18e)||!_0x14f3d0['source']),_0x3d9362=_0x89def6[_0x19d079(0x19a)](_0x236f90=>_0x236f90[_0x19d079(0x13b)]===_0x19d079(0x1f9));return{'totalSessions':_0x89def6[_0x19d079(0x1ae)],'connectedSessions':_0x41ff8b['length'],'telegramSessions':_0x5bee8a[_0x19d079(0x1ae)],'webSessions':_0x3d9362[_0x19d079(0x1ae)],'detectedWebSessions':this[_0x19d079(0x155)]['size'],'activeSockets':this[_0x19d079(0x18f)]['size'],'eventHandlersEnabled':this[_0x19d079(0x188)],'maxSessions':this[_0x19d079(0x154)],'isInitialized':this[_0x19d079(0x1fd)],'enable515Flow':ENABLE_515_FLOW,'storage':this['storage']?.[_0x19d079(0x141)]?_0x19d079(0x16a):_0x19d079(0x201),'webDetection':this['webSessionDetector']?.[_0x19d079(0x13f)]()?_0x19d079(0x20d):_0x19d079(0x1cb),'mongoConnected':this[_0x19d079(0x169)]?.['isMongoConnected']||![],'postgresConnected':this[_0x19d079(0x169)]?.[_0x19d079(0x1a2)]||![],'stateStats':this[_0x19d079(0x23b)][_0x19d079(0x1d1)]()};}catch(_0x15b25f){return logger['error'](_0x19d079(0x13e),_0x15b25f),{'error':_0x19d079(0x19c),'activeSockets':this['activeSockets'][_0x19d079(0x1ec)]};}}async['shutdown'](){const _0x4b3a45=_0x488f95;try{logger[_0x4b3a45(0x1cf)](_0x4b3a45(0x1b1)),this[_0x4b3a45(0x1a6)]();const _0x51c1af=[];for(const _0x38f963 of this[_0x4b3a45(0x18f)]['keys']()){_0x51c1af[_0x4b3a45(0x178)](this[_0x4b3a45(0x1d8)](_0x38f963));}await Promise[_0x4b3a45(0x1fc)](_0x51c1af),this[_0x4b3a45(0x169)]&&await this[_0x4b3a45(0x169)][_0x4b3a45(0x138)](),this[_0x4b3a45(0x1c1)]&&await this['connectionManager'][_0x4b3a45(0x164)](),logger[_0x4b3a45(0x1cf)](_0x4b3a45(0x18b));}catch(_0x24544f){logger[_0x4b3a45(0x1e0)](_0x4b3a45(0x227),_0x24544f);}}async[_0x488f95(0x1bf)](){const _0x20ec07=_0x488f95;try{logger[_0x20ec07(0x184)]('Performing\x20session\x20manager\x20maintenance'),this[_0x20ec07(0x23b)]['cleanupStale'](),this[_0x20ec07(0x169)]?.[_0x20ec07(0x1c3)]&&await this[_0x20ec07(0x169)][_0x20ec07(0x1c3)](),this[_0x20ec07(0x229)]&&await this[_0x20ec07(0x229)][_0x20ec07(0x174)](this[_0x20ec07(0x169)]);}catch(_0x20788b){logger[_0x20ec07(0x1e0)](_0x20ec07(0x124),_0x20788b);}}['getConnectionManager'](){const _0x3c5dee=_0x488f95;return this[_0x3c5dee(0x1c1)];}[_0x488f95(0x133)](){const _0x3ff29e=_0x488f95;return this[_0x3ff29e(0x169)];}[_0x488f95(0x163)](){const _0x2ab1e4=_0x488f95;return this[_0x2ab1e4(0x23b)];}[_0x488f95(0x132)](){const _0x58e2fb=_0x488f95;return this[_0x58e2fb(0x19e)];}}let sessionManagerInstance=null;export function initializeSessionManager(_0x20a1e8,_0x10f856=_0x488f95(0x1bc)){return!sessionManagerInstance&&(sessionManagerInstance=new SessionManager(_0x20a1e8,_0x10f856)),sessionManagerInstance;}export function getSessionManager(){const _0x4b4eaa=_0x488f95;return!sessionManagerInstance&&(sessionManagerInstance=new SessionManager(null,_0x4b4eaa(0x1bc))),sessionManagerInstance;}export function resetSessionManager(){sessionManagerInstance=null;}
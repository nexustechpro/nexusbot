const _0x45dd54=_0x2a88;(function(_0x215388,_0xe227d8){const _0x573f9d=_0x2a88,_0xeefec2=_0x215388();while(!![]){try{const _0x24f475=-parseInt(_0x573f9d(0x1f9))/0x1*(parseInt(_0x573f9d(0x1a8))/0x2)+parseInt(_0x573f9d(0x200))/0x3*(parseInt(_0x573f9d(0x1ed))/0x4)+-parseInt(_0x573f9d(0x1d3))/0x5+-parseInt(_0x573f9d(0x1db))/0x6*(-parseInt(_0x573f9d(0x1f6))/0x7)+-parseInt(_0x573f9d(0x18c))/0x8+parseInt(_0x573f9d(0x1d1))/0x9+-parseInt(_0x573f9d(0x1c4))/0xa;if(_0x24f475===_0xe227d8)break;else _0xeefec2['push'](_0xeefec2['shift']());}catch(_0x4b0e06){_0xeefec2['push'](_0xeefec2['shift']());}}}(_0xb147,0x99a8f));import _0x2b55e5 from'dotenv';_0x2b55e5[_0x45dd54(0x1eb)]();import{EventEmitter}from'events';EventEmitter[_0x45dd54(0x1da)]=0x384,process[_0x45dd54(0x19e)](0x384),process[_0x45dd54(0x19e)](0x0);if(process['env'][_0x45dd54(0x18a)]!==_0x45dd54(0x209)){const originalStdoutWrite=process[_0x45dd54(0x1f5)][_0x45dd54(0x1fc)][_0x45dd54(0x1fa)](process['stdout']),originalStderrWrite=process[_0x45dd54(0x20f)][_0x45dd54(0x1fc)]['bind'](process['stderr']),suppressPatterns=[_0x45dd54(0x1b3),_0x45dd54(0x1c0),_0x45dd54(0x1f8),_0x45dd54(0x1b2),_0x45dd54(0x206),_0x45dd54(0x1d8),_0x45dd54(0x1f3),_0x45dd54(0x18f),'currentRatchet',_0x45dd54(0x196),'indexInfo',_0x45dd54(0x211),_0x45dd54(0x20a),_0x45dd54(0x1aa),_0x45dd54(0x1e5),_0x45dd54(0x18e),'lastRemoteEphemeralKey',_0x45dd54(0x19f),_0x45dd54(0x1ce),'baseKeyType',_0x45dd54(0x1df),_0x45dd54(0x1d5),'chainKey',_0x45dd54(0x1a3),_0x45dd54(0x19b),_0x45dd54(0x184),_0x45dd54(0x1f7),'closed:'],shouldSuppress=_0xb0ef85=>{const _0x26d3e0=_0x45dd54,_0xe86f4c=_0xb0ef85[_0x26d3e0(0x1ec)]();return suppressPatterns[_0x26d3e0(0x1a9)](_0x313cfd=>_0xe86f4c[_0x26d3e0(0x1a4)](_0x313cfd));};process[_0x45dd54(0x1f5)]['write']=function(_0xb3c5c4,_0x2830ee,_0x24d514){const _0x423ab7=_0x45dd54;if(!shouldSuppress(_0xb3c5c4))return originalStdoutWrite(_0xb3c5c4,_0x2830ee,_0x24d514);if(typeof _0x2830ee===_0x423ab7(0x204))_0x2830ee();else{if(typeof _0x24d514===_0x423ab7(0x204))_0x24d514();}return!![];},process['stderr'][_0x45dd54(0x1fc)]=function(_0x1af08e,_0x12007e,_0x2f1da3){const _0x2cdf31=_0x45dd54;if(!shouldSuppress(_0x1af08e))return originalStderrWrite(_0x1af08e,_0x12007e,_0x2f1da3);if(typeof _0x12007e===_0x2cdf31(0x204))_0x12007e();else{if(typeof _0x2f1da3==='function')_0x2f1da3();}return!![];},console[_0x45dd54(0x199)](_0x45dd54(0x1c2));}function _0xb147(){const _0x510fc2=['toString','8rNdpYC','loadPlugins','size','âŒ\x20Database\x20verification\x20failed\x20-\x20continuing\x20anyway','ğŸ’¬\x20[5/9]\x20Initializing\x20WhatsApp\x20module...','initializingSessions','_chains','âœ…\x20WhatsApp\x20module\x20initialized\x20(','stdout','1379MbxBUp','created:','Closing','1YISUdH','bind','âœ…\x20HTTP\x20server\x20closed','write','âŒ\x20Unhandled\x20Rejection:','ğŸ”„\x20[3/9]\x20Running\x20database\x20migrations...','â³\x20[8/9]\x20Waiting\x2010s\x20for\x20final\x20stabilization...','1433430vaVtWm','storage','âŒ\x20Database\x20URL\x20configuration\x20failed\x20-\x20continuing\x20anyway','now','function','âš ï¸\x20MongoDB\x20disconnected\x20for\x20','Bad\x20MAC','getStats','\x20minutes\x20(','false','baseKey','DATABASE_URL','âŒ\x20Scheduler\x20initialization\x20failed\x20-\x20continuing\x20anyway','âœ…\x20MongoDB\x20connection\x20recovered\x20after\x20','message','stderr','âœ…\x20Database\x20verified','pendingPreKey','RENDER_EXTERNAL_URL','âœ¨\x20Platform\x20Initialization\x20Complete!','âš ï¸\x20\x20Warning:','âœ…\x20Group\x20Scheduler\x20started','Error\x20in\x20safeAsync:\x20','â­ï¸\x20\x20Proceeding\x20without\x20pre-configured\x20phone\x20number','used:','30mb','â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•','âš ï¸\x20\x20Platform\x20already\x20initialized','âŒ\x20HTTP\x20server\x20failed\x20-\x20platform\x20may\x20be\x20inaccessible','âœ…\x20Migrations\x20completed','SUPPRESS_LIBRARY_LOGS','\x20checks)','4706192TZViPI','exit','privKey','registrationId','use','WHATSAPP_PHONE_NUMBER','info','get','activeSockets','name','ephemeralKeyPair','â°\x20Keep-alive\x20cron\x20job\x20started\x20(pings\x20every\x2010\x20minutes)','error','log','\x20\x20\x20https://github.com/nexustechpro/nexusbot#database-setup','messageKeys','static','close','setMaxListeners','previousCounter','ğŸ“Š\x20Storage\x20fallback:\x20PostgreSQL=','âš ï¸\x20\x20No\x20database\x20URL\x20configured\x20-\x20sessions\x20may\x20not\x20persist','warn','chainType','includes','urlencoded','ğŸ“±\x20[1/9]\x20Checking\x20phone\x20number\x20configuration...','SIGINT','353506dJavZx','some','remoteIdentityKey','ğŸ“Š\x20[2/9]\x20Connecting\x20to\x20database...','ğŸš€\x20Starting\x20Platform\x20Initialization','toISOString','â°\x20[7/9]\x20Initializing\x20Group\x20Scheduler...','listen','âŒ\x20WhatsApp\x20initialization\x20failed\x20-\x20continuing\x20anyway','ğŸŒ\x20[9/9]\x20Starting\x20HTTP\x20server...','libsignal','SessionEntry','âš ï¸\x20\x20No\x20session\x20manager\x20-\x20skipping\x20scheduler','round','ğŸ’š\x20Health:\x20http://localhost:','WhatsAppBot\x20Platform','âœ…\x20Session\x20manager\x20shutdown','then','ğŸ“Š\x20Status:\x20http://localhost:','/health','MAIN','catch','âŒ\x20Database\x20connection\x20failed\x20-\x20continuing\x20anyway','public','<Buffer','âŒ\x20Uncaught\x20Exception:','ğŸ”‡\x20Library\x20log\x20suppression\x20active','âš ï¸\x20\x20Graceful\x20shutdown\x20failed,\x20forcing\x20exit','5966970SiLtWb','uncaughtException','âœ…\x20HTTP\x20server\x20started','stack','start','âŒ\x20Plugin\x20loading\x20failed\x20-\x20continuing\x20anyway','âŒ\x20Migration\x20failed\x20-\x20continuing\x20anyway','âœ…\x20Group\x20scheduler\x20stopped','âœ…\x20Phone\x20number\x20configured:\x20','âœ…\x20Database\x20connected\x20and\x20warmed\x20up','rootKey','ğŸ”„\x20Server\x20will\x20continue\x20in\x20degraded\x20mode...','env','2211777oWPBJj','\x20\x20\x20Consider\x20setting\x20up\x20a\x20free\x20PostgreSQL\x20database:','2174050PJKUMz','json','preKeyId','ğŸ”\x20[8/9]\x20Verifying\x20database\x20connection...','isMongoConnected','session_cipher','âŒ\x20Platform\x20initialization\x20error:','defaultMaxListeners','37296iaUruT','fileManager','ğŸ›‘\x20Shutdown\x20requested\x20(','getInitializationStatus','signedKeyId','/api/status','uptime','initializing','warning','SIGTERM','pubKey','â³\x20[6/9]\x20Waiting\x2010s\x20for\x20WhatsApp\x20sessions\x20to\x20stabilize...','shutdown','âœ…\x20Keep-alive\x20ping\x20successful','âœ…\x20Database\x20pool\x20closed','postgresql','config'];_0xb147=function(){return _0x510fc2;};return _0xb147();}import _0x526c4b from'express';import _0x1f95e1 from'cookie-parser';import{createComponentLogger}from'./utils/logger.js';import{getPhoneNumber,formatPhoneForDisplay}from'./utils/phone-input.js';function _0x2a88(_0x3436ff,_0x471479){_0x3436ff=_0x3436ff-0x181;const _0xb147e=_0xb147();let _0x2a8884=_0xb147e[_0x3436ff];return _0x2a8884;}import{getDatabaseUrl,formatDatabaseForLogging}from'./utils/database-input.js';import{testConnection,closePool}from'./config/database.js';import{runMigrations}from'./database/migrations/run-migrations.js';import{quickSetup as _0xcd0107}from'./whatsapp/index.js';import{GroupScheduler}from'./database/groupscheduler.js';import _0x2452dc from'./utils/plugin-loader.js';const logger=createComponentLogger(_0x45dd54(0x1bc)),PORT=process[_0x45dd54(0x1d0)]['PORT']||0xbb8,app=_0x526c4b();let sessionManager=null,groupScheduler=null,server=null,isInitialized=![];app['use'](_0x526c4b[_0x45dd54(0x1d4)]({'limit':_0x45dd54(0x185)})),app[_0x45dd54(0x190)](_0x526c4b[_0x45dd54(0x1a5)]({'extended':!![],'limit':_0x45dd54(0x185)})),app[_0x45dd54(0x190)](_0x526c4b[_0x45dd54(0x19c)](_0x45dd54(0x1bf))),app['use'](_0x1f95e1()),app[_0x45dd54(0x193)](_0x45dd54(0x1bb),async(_0x2c65af,_0x58fd69)=>{const _0x30e8a1=_0x45dd54;_0x58fd69[_0x30e8a1(0x1d4)]({'status':'healthy','timestamp':new Date()[_0x30e8a1(0x1ad)](),'uptime':process[_0x30e8a1(0x1e1)](),'initialized':isInitialized,'components':{'database':!![],'whatsapp':!!sessionManager,'sessions':sessionManager?.[_0x30e8a1(0x194)]?.[_0x30e8a1(0x1ef)]||0x0,'scheduler':!!groupScheduler}});}),app[_0x45dd54(0x193)]('/api/status',async(_0x15e950,_0x256698)=>{const _0x5e368d=_0x45dd54,_0x47a8a9=sessionManager?await safeAsync(()=>sessionManager[_0x5e368d(0x207)](),{}):{};_0x256698[_0x5e368d(0x1d4)]({'platform':_0x5e368d(0x1b7),'status':isInitialized?'operational':_0x5e368d(0x1e2),'sessions':_0x47a8a9});});async function safeAsync(_0x179868,_0x9fefc8=null){const _0x16079a=_0x45dd54;try{return await _0x179868();}catch(_0x23cbe6){return logger[_0x16079a(0x198)](_0x16079a(0x182)+_0x23cbe6['message']),_0x9fefc8;}}async function initializePlatform(){const _0x5d66cf=_0x45dd54;if(isInitialized){logger[_0x5d66cf(0x1a2)](_0x5d66cf(0x187));return;}logger['info'](_0x5d66cf(0x186)),logger[_0x5d66cf(0x192)](_0x5d66cf(0x1ac)),logger[_0x5d66cf(0x192)](_0x5d66cf(0x186)),logger[_0x5d66cf(0x192)]('ğŸ—„ï¸\x20\x20[0/9]\x20Checking\x20database\x20configuration...');try{const _0x48b687=await getDatabaseUrl();_0x48b687?(logger['info']('âœ…\x20Database\x20URL\x20configured:\x20'+formatDatabaseForLogging(_0x48b687)),process[_0x5d66cf(0x1d0)][_0x5d66cf(0x20b)]=_0x48b687):(logger['warn'](_0x5d66cf(0x1a1)),logger[_0x5d66cf(0x1a2)](_0x5d66cf(0x1d2)),logger[_0x5d66cf(0x1a2)](_0x5d66cf(0x19a)));}catch(_0x5859a8){logger[_0x5d66cf(0x198)](_0x5d66cf(0x202)),logger[_0x5d66cf(0x198)](_0x5859a8[_0x5d66cf(0x20e)]);}let _0x3ea547=null;logger[_0x5d66cf(0x192)](_0x5d66cf(0x1a6));try{_0x3ea547=await getPhoneNumber(),_0x3ea547?(logger[_0x5d66cf(0x192)](_0x5d66cf(0x1cc)+formatPhoneForDisplay(_0x3ea547)),process[_0x5d66cf(0x1d0)][_0x5d66cf(0x191)]=_0x3ea547):logger[_0x5d66cf(0x192)](_0x5d66cf(0x183));}catch(_0x2da21d){logger[_0x5d66cf(0x198)]('âŒ\x20Phone\x20number\x20configuration\x20failed\x20-\x20continuing\x20anyway'),logger['error'](_0x2da21d[_0x5d66cf(0x20e)]);}logger[_0x5d66cf(0x192)](_0x5d66cf(0x1ab));try{await testConnection();for(let _0x2655f2=0x0;_0x2655f2<0x3;_0x2655f2++){await testConnection(),await new Promise(_0x400d89=>setTimeout(_0x400d89,0x3e8));}logger[_0x5d66cf(0x192)](_0x5d66cf(0x1cd));}catch(_0x58d687){logger[_0x5d66cf(0x198)](_0x5d66cf(0x1be)),logger[_0x5d66cf(0x198)](_0x58d687[_0x5d66cf(0x20e)]);}logger[_0x5d66cf(0x192)](_0x5d66cf(0x1fe));try{await runMigrations(),logger[_0x5d66cf(0x192)](_0x5d66cf(0x189));}catch(_0x48254f){logger[_0x5d66cf(0x198)](_0x5d66cf(0x1ca)),logger[_0x5d66cf(0x198)](_0x48254f[_0x5d66cf(0x20e)]);}logger[_0x5d66cf(0x192)]('ğŸ”Œ\x20[4/9]\x20Loading\x20plugins...');try{await _0x2452dc[_0x5d66cf(0x1ee)](),logger[_0x5d66cf(0x192)]('âœ…\x20Plugins\x20loaded\x20successfully');}catch(_0x46fd0f){logger[_0x5d66cf(0x198)](_0x5d66cf(0x1c9)),logger['error'](_0x46fd0f[_0x5d66cf(0x20e)]);}logger['info'](_0x5d66cf(0x1f1));try{sessionManager=await _0xcd0107(_0x3ea547),logger['info'](_0x5d66cf(0x1f4)+(sessionManager?.[_0x5d66cf(0x194)]?.[_0x5d66cf(0x1ef)]||0x0)+'\x20sessions)');}catch(_0x2fc837){logger['error'](_0x5d66cf(0x1b0)),logger[_0x5d66cf(0x198)](_0x2fc837['message']);}logger[_0x5d66cf(0x192)](_0x5d66cf(0x1e6)),await new Promise(_0x1e02f7=>setTimeout(_0x1e02f7,0x2710)),logger[_0x5d66cf(0x192)](_0x5d66cf(0x1ae));try{sessionManager?(groupScheduler=new GroupScheduler(sessionManager),groupScheduler[_0x5d66cf(0x1c8)](),logger['info'](_0x5d66cf(0x181))):logger[_0x5d66cf(0x1a2)](_0x5d66cf(0x1b4));}catch(_0x3605d5){logger[_0x5d66cf(0x198)](_0x5d66cf(0x20c)),logger[_0x5d66cf(0x198)](_0x3605d5['message']);}logger[_0x5d66cf(0x192)](_0x5d66cf(0x1ff)),await new Promise(_0x16cbbe=>setTimeout(_0x16cbbe,0x2710)),logger[_0x5d66cf(0x192)](_0x5d66cf(0x1d6));try{await testConnection(),logger[_0x5d66cf(0x192)](_0x5d66cf(0x210));}catch(_0x31406d){logger[_0x5d66cf(0x198)](_0x5d66cf(0x1f0)),logger['error'](_0x31406d[_0x5d66cf(0x20e)]);}logger[_0x5d66cf(0x192)](_0x5d66cf(0x1b1));try{server=app[_0x5d66cf(0x1af)](PORT,()=>{const _0x394920=_0x5d66cf;logger[_0x394920(0x192)](_0x394920(0x1c6)),logger[_0x394920(0x192)]('ğŸ”—\x20Server:\x20http://localhost:'+PORT),logger[_0x394920(0x192)](_0x394920(0x1b6)+PORT+_0x394920(0x1bb)),logger['info'](_0x394920(0x1ba)+PORT+_0x394920(0x1e0));});}catch(_0x59d61b){logger[_0x5d66cf(0x198)](_0x5d66cf(0x188)),logger[_0x5d66cf(0x198)](_0x59d61b[_0x5d66cf(0x20e)]);}setupMaintenanceTasks(),setupConnectionMonitor(),setupKeepAlive(),isInitialized=!![],logger[_0x5d66cf(0x192)](_0x5d66cf(0x186)),logger[_0x5d66cf(0x192)](_0x5d66cf(0x213)),logger[_0x5d66cf(0x192)](_0x5d66cf(0x186));}function setupMaintenanceTasks(){let _0x29cbc5=![];setInterval(async()=>{const _0x23e929=_0x2a88;if(_0x29cbc5)return;_0x29cbc5=!![];try{if(sessionManager?.[_0x23e929(0x201)]){const _0x21c360=sessionManager[_0x23e929(0x1de)]();_0x21c360[_0x23e929(0x1f2)]===0x0&&await testConnection();}}catch(_0x1538a1){}_0x29cbc5=![];},0x927c0);}function setupConnectionMonitor(){let _0x4decfa=0x0,_0x210e89=0x0,_0x438b8b=0x0;const _0x5bc46f=0x493e0,_0x4df518=0xea60;setInterval(async()=>{const _0x13dbe4=_0x2a88;try{const _0x1f284e=Date[_0x13dbe4(0x203)]();if(sessionManager?.[_0x13dbe4(0x201)]?.[_0x13dbe4(0x1d7)])_0x4decfa>0x0&&(_0x1f284e-_0x438b8b>_0x4df518&&(logger[_0x13dbe4(0x192)](_0x13dbe4(0x20d)+_0x4decfa+'\x20failures\x20('+Math['round'](_0x4decfa*0x1e/0x3c)+'\x20minutes)'),_0x438b8b=_0x1f284e),_0x4decfa=0x0);else{_0x4decfa++;const _0x1da29f=_0x4decfa===0x3||_0x4decfa>=0xa&&_0x1f284e-_0x210e89>_0x5bc46f;if(_0x1da29f){const _0x1667d3=Math[_0x13dbe4(0x1b5)](_0x4decfa*0x1e/0x3c),_0x58ec9b=sessionManager?.[_0x13dbe4(0x201)]?.['getConnectionStatus']?.();logger['warn'](_0x13dbe4(0x205)+_0x1667d3+_0x13dbe4(0x208)+_0x4decfa+_0x13dbe4(0x18b)),_0x58ec9b&&logger[_0x13dbe4(0x192)](_0x13dbe4(0x1a0)+_0x58ec9b[_0x13dbe4(0x1ea)]+',\x20Files='+_0x58ec9b[_0x13dbe4(0x1dc)]),_0x210e89=_0x1f284e;}}}catch(_0x1e8471){}},0x7530);}function setupKeepAlive(){const _0x240619=_0x45dd54,_0x157e6b=0x1*0x3c*0x3e8;setInterval(async()=>{const _0x577052=_0x2a88;try{const _0x4d1c05=process[_0x577052(0x1d0)][_0x577052(0x212)]||'http://localhost:'+PORT;await fetch(_0x4d1c05+_0x577052(0x1bb))[_0x577052(0x1b9)](_0x19e029=>_0x19e029[_0x577052(0x1d4)]())['then'](()=>logger[_0x577052(0x192)](_0x577052(0x1e8)))['catch'](()=>{});}catch(_0x3bfc4e){}},_0x157e6b),logger[_0x240619(0x192)](_0x240619(0x197));}async function gracefulShutdown(_0x4bc1ea){const _0x2deec3=_0x45dd54;logger['info'](_0x2deec3(0x1dd)+_0x4bc1ea+')');try{server&&(await new Promise(_0x1443e9=>server[_0x2deec3(0x19d)](_0x1443e9)),logger[_0x2deec3(0x192)](_0x2deec3(0x1fb))),groupScheduler&&(await groupScheduler['stop']?.(),logger['info'](_0x2deec3(0x1cb))),sessionManager&&(await sessionManager[_0x2deec3(0x1e7)](),logger[_0x2deec3(0x192)](_0x2deec3(0x1b8))),await closePool(),logger[_0x2deec3(0x192)](_0x2deec3(0x1e9)),logger[_0x2deec3(0x192)]('âœ…\x20Graceful\x20shutdown\x20completed'),process[_0x2deec3(0x18d)](0x0);}catch(_0xc89846){logger[_0x2deec3(0x1a2)](_0x2deec3(0x1c3)),logger['error'](_0xc89846[_0x2deec3(0x20e)]),process['exit'](0x1);}}process['on'](_0x45dd54(0x1a7),()=>gracefulShutdown(_0x45dd54(0x1a7))),process['on'](_0x45dd54(0x1e4),()=>gracefulShutdown(_0x45dd54(0x1e4))),process['on'](_0x45dd54(0x1c5),_0x4bd8a2=>{const _0x48f21c=_0x45dd54;logger[_0x48f21c(0x198)](_0x48f21c(0x1c1),_0x4bd8a2[_0x48f21c(0x20e)]),logger[_0x48f21c(0x198)](_0x4bd8a2[_0x48f21c(0x1c7)]),logger[_0x48f21c(0x192)]('ğŸ”„\x20Server\x20continuing\x20despite\x20error...');}),process['on']('unhandledRejection',_0x5dfdfa=>{const _0x49a933=_0x45dd54;logger['error'](_0x49a933(0x1fd),_0x5dfdfa),logger['info']('ğŸ”„\x20Server\x20continuing\x20despite\x20error...');}),process['on'](_0x45dd54(0x1e3),_0x4a4e0c=>{const _0x3cf877=_0x45dd54;_0x4a4e0c[_0x3cf877(0x195)]!=='MaxListenersExceededWarning'&&logger['warn'](_0x3cf877(0x214),_0x4a4e0c[_0x3cf877(0x20e)]);}),initializePlatform()[_0x45dd54(0x1bd)](_0xd2ebdb=>{const _0x1a5870=_0x45dd54;logger[_0x1a5870(0x198)](_0x1a5870(0x1d9),_0xd2ebdb[_0x1a5870(0x20e)]),logger[_0x1a5870(0x192)](_0x1a5870(0x1cf)),!server&&(server=app[_0x1a5870(0x1af)](PORT,()=>{const _0x93b8f4=_0x1a5870;logger[_0x93b8f4(0x192)]('ğŸ”—\x20Server\x20running\x20on\x20port\x20'+PORT+'\x20(degraded\x20mode)');})),isInitialized=!![];});